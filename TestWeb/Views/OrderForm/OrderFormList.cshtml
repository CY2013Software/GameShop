@using DAL;
@using shop.Models;
@{
    ViewBag.Title = "OrderFormList";
    List<UserOrderForm> orderFormList = (List<UserOrderForm>)ViewData["OrderFormList"];
    Layout = "~/Views/Shared/_Layout.cshtml";

    string UserEmail = "";
    HttpCookie aCookie = Request.Cookies["UserEmail"];
    if (aCookie != null)
    {
        UserEmail = Server.HtmlEncode(aCookie.Value);
    }
}

<style type="text/css">
    .cart_ul li {
        width: 1000px;
        height: 100px;
        padding: 10px;
        list-style-type: none;
    }
</style>

@{
    if (!string.IsNullOrEmpty(UserEmail))
    {
        <h2>个人订单</h2>

        if (orderFormList.Count > 0)
        {
            decimal price = new decimal(0);

            <ul class="cart_ul">
                @{
            foreach (UserOrderForm item in orderFormList)
            {
                System.Data.DataTable _goodsInfoTable = new GoodsInfoDAL().GoodsInfoQuery(item.GoodsId);
                price = ((decimal)_goodsInfoTable.Rows[0]["goods_price_now"]) * item.GoodsPurchaseQuantity;
                <li style="border:1px solid red;">

                    <img src="@(_goodsInfoTable.Rows[0]["goods_image"])" style="margin-top:6px;margin-right: 40px;float: left;height: 60px;width: 7%;" />
                    <a href="/Goods/GoodsInfo?goods_id=@(item.GoodsId)"><span style="float:left;margin-right:40px;margin-top:25px">@(_goodsInfoTable.Rows[0]["goods_name"])</span></a>
                    <label>数量：</label><input value="@(item.GoodsPurchaseQuantity)" style="width:40px;margin-right:40px;margin-top:25px" disabled />
                    <label>总价：</label><span style="color:red;margin-right:30px;margin-top:25px">@(price)</span>
                    @{
                if (item.UserOrderFormStatusId == 1) { 
                    <span >未付款</span>
    <form action="/OrderForm/OrderFormList" method="post" style="margin-top: -25px">
        <input name="id" value="0" style="display:none" />
        <input name="UserOrderFormId" value="@(item.UserOrderFormId)" style="display:none" />
        <input name="UserId" value="@(item.UserId)" style="display:none" />
        <input name="GoodsPurchaseQuantity" value="@(item.GoodsPurchaseQuantity)" style="display:none" />
        <input type="submit" value="取消" style="float: right;margin-right: 30px;" />
    </form>
    <form action="/OrderForm/PayMent" method="get" style="margin-top: -26px">
        <input name="orderId" value="@(item.UserOrderFormId.ToString())" style="display:none" />
        <input type="submit" value="付款" style="float: right;margin-right: 10px;" />
    </form>
                }
                else if (item.UserOrderFormStatusId == 2)
                {
                    <span>已付款</span>
    <form action="/OrderForm/OrderFormList" method="post" style="margin-top: -25px">
        <input name="id" value="1" style="display:none" />
        <input name="UserOrderFormId" value="@(item.UserOrderFormId)" style="display:none" />
        <input name="UserId" value="@(item.UserId)" style="display:none" />
        <input type="submit" value="确认收货" style="float: right;margin-right: 30px;" />
    </form>
                }
                else if (item.UserOrderFormStatusId == 3)
                {
                    <span>已取消</span>
                }
                else
                {
                    <span>已收货</span>
    <form action="/OrderForm/Remark" method="get" style="margin-top: -25px">
        <input name="GoodsId" value="@(item.GoodsId)" style="display:none" />
        <input name="UserId" value="@(item.UserId)" style="display:none" />
        <input type="submit" value="评论" style="float: right;margin-right: 30px;" />
    </form>
                }
}                 
                </li>
                    <li style="clear:both"><br /><br /><br /><br /><br /><br /></li>

            }
                }
            </ul>
        }
        else
        {
            <span style="font-size:35px;color:red">还没有订单！</span>
        }
    }
    else
    {
        <h2 style="color:red">请先<a href="/User/Login">登录</a></h2>
    }
}


